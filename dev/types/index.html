<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The MolecularEvolution.jl Framework · MolecularEvolution.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://MurrellGroup.github.io/MolecularEvolution.jl/types/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="MolecularEvolution.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MolecularEvolution.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li class="is-active"><a class="tocitem" href>The MolecularEvolution.jl Framework</a><ul class="internal"><li><a class="tocitem" href="#Partitions-and-BranchModels"><span>Partitions and BranchModels</span></a></li><li><a class="tocitem" href="#Messages"><span>Messages</span></a></li><li><a class="tocitem" href="#Trees"><span>Trees</span></a></li><li><a class="tocitem" href="#Algorithms"><span>Algorithms</span></a></li></ul></li><li><a class="tocitem" href="../simulation/">Simulation</a></li><li><a class="tocitem" href="../optimization/">Optimization</a></li><li><a class="tocitem" href="../ancestors/">Ancestral Reconstruction</a></li><li><a class="tocitem" href="../viz/">Visualization</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>The MolecularEvolution.jl Framework</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The MolecularEvolution.jl Framework</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/MurrellGroup/MolecularEvolution.jl/blob/main/docs/src/types.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-MolecularEvolution.jl-Framework"><a class="docs-heading-anchor" href="#The-MolecularEvolution.jl-Framework">The MolecularEvolution.jl Framework</a><a id="The-MolecularEvolution.jl-Framework-1"></a><a class="docs-heading-anchor-permalink" href="#The-MolecularEvolution.jl-Framework" title="Permalink"></a></h1><p>The organizing principle is that the core algorithms, including Felsenstein&#39;s algorithm, but also a related family of message passing algorithms and inference machinery, are implemented in a way that does not refer to any specific model or even to any particular data type.</p><h2 id="Partitions-and-BranchModels"><a class="docs-heading-anchor" href="#Partitions-and-BranchModels">Partitions and BranchModels</a><a id="Partitions-and-BranchModels-1"></a><a class="docs-heading-anchor-permalink" href="#Partitions-and-BranchModels" title="Permalink"></a></h2><p>A <code>Partition</code> is a probabilistic representation of some kind of state. Specifically, it needs to be able to represent P(obs|state) and P(obs,state) when considered as functions of state. So it will typically be able to assign a probability to any possible value of state, and is unnormalized - not required to sum or integrate to 1 over all values of state. As an example, for a discrete state with 4 categories, this could just be a vector of 4 numbers.</p><p>For a <code>Partition</code> type to be usable by MolecularEvolution.jl, the <code>combine!</code> function needs to be implemented. If you have P(obsA|state) and P(obsB|state), then <code>combine!</code> calculates P(obsA,obsB|state) under the assumption that obsA and obsB are conditionally independent given state. <code>MolecularEvolution.jl</code> tries to avoid allocating memory, so <code>combine!(dest,src)</code> places in <code>dest</code> the combined <code>Partition</code> in <code>dest</code>. For a discrete state with 4 categories, this is simply element-wise multiplication of two state vectors.</p><p>A <code>BranchModel</code> defines how <code>Partition</code> distributions evolve along branches. Two functions need to be implemented: <code>backward!</code> and <code>forward!</code>. We imagine our trees with the root at the top, and <code>forward!</code> moves from root to tip, and <code>backward!</code> moves from tip to root. <code>backward!(dest::P,src::P,m::BranchModel,n::FelNode)</code> takes a src Partition, representing P(obs-below|state-at-bottom-of-branch), and modifies the dest Partition to be P(obs-below|state-at-top-of-branch), where the branch in question is the branch above the <code>FelNode</code> n. <code>forward!</code> goes in the opposite direction, from P(obs-above,state-at-top-of-branch) to P(obs-above,state-at-bottom-of-branch), with the <code>Partitions</code> now, confusingly, representing joint distributions.</p><h2 id="Messages"><a class="docs-heading-anchor" href="#Messages">Messages</a><a id="Messages-1"></a><a class="docs-heading-anchor-permalink" href="#Messages" title="Permalink"></a></h2><p>Nodes on our trees work with messages, where a <code>message</code> is a vector of <code>Partition</code> structs. This is in case you wish to model multiple different data types on the same tree. Often, all the messages on the tree will just be arrays containing a single <code>Partition</code>, but if you&#39;re accessing them you need to remember that they&#39;re in an array!</p><h2 id="Trees"><a class="docs-heading-anchor" href="#Trees">Trees</a><a id="Trees-1"></a><a class="docs-heading-anchor-permalink" href="#Trees" title="Permalink"></a></h2><p>Each node in our tree is a <code>FelNode</code> (&quot;Fel&quot; for &quot;Felsenstein&quot;). They point to their parent nodes, and an array of their children, and they store their main vector of <code>Partition</code>s, but also cached versions of those from their parents and children, to allow certain message passing schemes. They also have a <code>branchlength</code> field, which tells eg. <code>forward!</code> and <code>backward!</code> how much evolution occurs along the branch above (ie. closer to the root) that node. They also allow for an arbitrary dictionary of <code>node_data</code>, in case a model needs any other branch-specific parameters.</p><p>The set of algorithms needs to know which model to use for which partition, so the assumption made is that they&#39;ll see an array of models whose order will match the partition array. In general, we might want the models to vary from one branch to another, so the central algorithms take a function that associates a <code>FelNode-&gt;Vector{:&lt;BranchModel}</code>. In the simpler cases where the model does not vary from branch to branch, or where there is only a single Partition, and thus a single model, the core algorithms have been overloaded to allow you to pass in a single model vector or a single model.</p><h2 id="Algorithms"><a class="docs-heading-anchor" href="#Algorithms">Algorithms</a><a id="Algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithms" title="Permalink"></a></h2><p>To-do: list algorithms, describing what they compute, and what they modify.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quickstart/">« Quick Start</a><a class="docs-footer-nextpage" href="../simulation/">Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 6 September 2022 15:00">Tuesday 6 September 2022</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
